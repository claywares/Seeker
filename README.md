# Seeker - 时间序列异常检测机器学习项目

## 异常定义

在 Seeker 项目中，异常（Anomaly）指的是时间序列中明显偏离预期行为的数据点或模式。根据历史数据学习得到的正常行为作为基准，可以识别以下类型的异常：

*点异常*: 单个数据点明显高于或低于序列中的其他值。

*上下文异常*: 数据点在特定上下文中才被视为异常（例如：某个值在周末是正常的，但在工作日则属于异常）。

*集合异常*: 一组数据点作为整体呈现异常，即使单个点可能都在正常范围内。

### 局限性
Seeker 目前主要聚焦于单变量时间序列的点异常检测。以下类型的异常暂不在支持范围内：

- 上下文异常
- 渐变趋势或微小的趋势变化
- 多变量或高度不规则时间序列中的异常
- 需要领域专业知识或外部上下文的异常

## 点异常检测
点异常是最简单也是最常见的异常类型，非常适合首次实验和演示。例如，CPU 使用率和内存占用的瞬时突增或突降都属于点异常。

检测方法

统计方法
- Z-score（标准分数）法
- IQR（四分位距）法
- EWMA（指数加权移动平均）法

机器学习方法
- Isolation Forest（孤立森林）
- LOF（局部离群因子）

### Z-score方法
选择 3 作为阈值基于统计学中的"三西格玛法则"（68-95-99.7规则）：
#### 数据分布特征
- ±1σ 区间：包含约 68% 的数据
- ±2σ 区间：包含约 95% 的数据
- ±3σ 区间：包含约 99.7% 的数据
#### 阈值选择权衡
- 较低阈值（如 2σ）：检测更敏感但假阳性率更高
- 较高阈值（如 4σ）：假阳性率低但可能漏检
- 3σ：在大多数场景下能较好平衡准确率和召回率

### IQR方法
#### 四分位数解释
- Q1（第一四分位数）：25% 的数据小于此值
- Q3（第三四分位数）：75% 的数据小于此值
- IQR = Q3 - Q1：包含中间 50% 数据的范围
#### k 参数说明（通常取 1.5）
- 用于控制检测的敏感度
- k=1.5：标准设置，检测强度适中
- k=3.0：宽松设置，降低误报
- k 值越小，检出的异常越多
#### 异常判定边界
- 下界 = Q1 - k×IQR
- 上界 = Q3 + k×IQR
- 超出这些边界的点被判定为异常

### EWMA方法
#### 基本原理
- EWMA（指数加权移动平均）对最近的数据赋予更高权重
- 通过移动窗口计算局部统计特征
- 特别适合检测突发性异常

#### span参数说明（通常取5-20）
- 控制移动窗口大小和权重衰减速度
- span越小，对近期数据越敏感
- span=5：快速响应，适合检测突变
- span=20：平滑处理，降低误报

#### threshold参数说明（通常取1.5-3.0）
- 用于控制检测的敏感度
- threshold=1.5：敏感度高，可能有更多误报
- threshold=3.0：更保守，减少误报
- threshold越小，检出的异常越多

#### 异常判定方式
- 计算数据点与EWMA均值的偏差
- 将偏差与局部标准差的threshold倍比较
- 超出阈值的点被判定为异常

### 方法对比

| 检测方法 | 适用场景 | 优点 | 缺点 |
|---------|---------|------|------|
| Z-score | CPU突发峰值监控 | • 计算简单<br>• 容易理解<br>• 适合正态分布数据 | • 受极端值影响大<br>• 假设数据正态分布 |
| IQR | 长期趋势异常 | • 对异常值不敏感<br>• 不依赖数据分布<br>• 稳定性好 | • 不适合实时检测<br>• 可能过于保守 |
| EWMA | 实时监控场景 | • 对突变敏感<br>• 考虑时序特性<br>• 适合实时数据 | • 参数调优较复杂<br>• 初始阶段不稳定 |
